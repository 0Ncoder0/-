# 计算机组成原理

## 1. 计算机系统概述

### 1.1 计算机发展历史

- 电子计算机的四代演进
  - 第一代（1946-1957）：电子管计算机
  - 第二代（1958-1964）：晶体管计算机
  - 第三代（1965-1974）：集成电路计算机
  - 第四代（1975-至今）：大规模集成电路计算机
- 摩尔定律
  - 集成电路芯片上的晶体管数量每 18-24 个月翻一番
  - 性能提升与功耗限制
- 当代计算机特点
  - 高性能与多核化
  - 低功耗与绿色计算
  - 智能化与专用化

### 1.2 计算机系统层次结构

- 硬件层次结构
  - 微程序级
  - 指令系统级
  - 操作系统级
  - 汇编语言级
  - 高级语言级
- 软件层次结构
  - 系统软件
  - 应用软件
  - 中间件
- 计算机组成五大部件
  - 运算器
  - 控制器
  - 存储器
  - 输入设备
  - 输出设备

### 1.3 计算机性能指标

- CPU 时钟周期
  - 时钟频率与周期的关系
  - 主频与实际性能
- CPI（每指令周期数）
  - CPI 的计算方法
  - 影响 CPI 的因素
- MIPS（每秒百万条指令数）
  - MIPS 的计算公式
  - MIPS 评价标准
- FLOPS（每秒浮点运算次数）
  - 单精度与双精度 FLOPS
  - 峰值 FLOPS 与持续 FLOPS

## 2. 数据的表示和运算

### 2.1 数制与编码

- 进制转换
  - 二进制、八进制、十进制、十六进制的相互转换
  - 小数部分的进制转换
  - 快速转换技巧
- BCD 码
  - 8421 BCD 码
  - 余 3 BCD 码
  - 2421 BCD 码
  - BCD 码的运算
- ASCII 码
  - 标准 ASCII 码（0-127）
  - 扩展 ASCII 码（128-255）
  - 控制字符与可打印字符
- Unicode 编码
  - UTF-8 编码方案
  - UTF-16 编码方案
  - UTF-32 编码方案
  - 码点与编码转换

### 2.2 定点数和浮点数

- 原码、反码、补码
  - 定点数的表示范围
  - 原码的特点与局限
  - 反码的转换规则
  - 补码的运算特性
- IEEE 754 标准
  - 单精度浮点数（32 位）格式
  - 双精度浮点数（64 位）格式
  - 特殊值表示（±0、±∞、NaN）
  - 规范化与非规范化数
- 浮点数运算
  - 对阶操作
  - 尾数运算
  - 结果规范化
  - 舍入处理
  - 溢出处理

### 2.3 算术运算和逻辑运算

- 加减法运算器
  - 一位全加器设计
  - 串行加法器
  - 并行加法器（先行进位）
  - 补码加减运算电路
- 乘除法运算器
  - 原码一位乘法器
  - 补码一位乘法器
  - 布斯乘法算法
  - 恢复余数除法
  - 不恢复余数除法
- ALU 的基本结构
  - 组合逻辑运算单元
  - 算术运算单元
  - 移位运算单元
  - 状态标志位生成

## 3. 存储系统

### 3.1 存储器层次结构

- 存储器分类
  - 按存取方式分类：随机访问、顺序访问、直接访问
  - 按功能分类：主存储器、辅助存储器、缓冲存储器
  - 按介质分类：半导体存储器、磁表面存储器、光存储器
- 存储器性能指标
  - 存储容量
  - 存取时间
  - 存储带宽
  - 位价格
  - 可靠性

### 3.2 主存储器

- RAM（DRAM/SRAM）
  - DRAM 工作原理与刷新机制
  - SRAM 的结构与特点
  - DDR SDRAM 的发展（DDR1-DDR5）
  - 内存条组织与带宽计算
- ROM（PROM/EPROM/EEPROM）
  - 掩模式 ROM
  - 可编程 ROM（PROM）
  - 可擦除可编程 ROM（EPROM）
  - 电可擦除可编程 ROM（EEPROM）
  - 闪存（Flash Memory）
- 主存储器与 CPU 的连接
  - 地址线连接
  - 数据线连接
  - 控制线连接
  - 存储器芯片的片选

### 3.3 高速缓存

- Cache 工作原理
  - 时间局部性与空间局部性
  - 命中率与缺失率
  - 替换算法（LRU、FIFO、随机）
- Cache 映射方式
  - 直接映射
  - 全相联映射
  - 组相联映射
  - 写操作策略（写直达、写回）
- Cache 一致性
  - 多级 Cache 结构
  - MESI 协议
  - 总线监听
  - 目录协议

### 3.4 虚拟存储器

- 页式存储管理
  - 页表结构
  - 快表（TLB）
  - 页面置换算法
  - 页面分配策略
- 段式存储管理
  - 段表结构
  - 段页式管理
  - 段的保护与共享
- 地址变换机构
  - 虚拟地址到物理地址的转换
  - 页表项的组成
  - 地址变换过程
  - 缺页处理

## 4. 指令系统

### 4.1 指令格式

- 操作码和地址码
  - 操作码的编码方式
    - 定长操作码
    - 变长操作码
  - 地址码的组成部分
    - 操作数地址
    - 结果地址
    - 下一条指令地址
- 定长指令格式
  - 单地址指令格式
  - 双地址指令格式
  - 三地址指令格式
  - 零地址指令格式
- 变长指令格式
  - 指令长度的确定方法
  - 变长指令的优缺点
  - 常见的变长指令格式实例

### 4.2 寻址方式

- 立即寻址
  - 操作数直接包含在指令中
  - 优点：无需访存
  - 缺点：数据范围受限
- 直接寻址
  - 指令直接给出操作数的内存地址
  - 优点：简单直观
  - 缺点：地址范围受限
- 间接寻址
  - 指令地址码给出操作数地址的地址
  - 优点：扩大寻址范围
  - 缺点：多次访存
- 寄存器寻址
  - 操作数在寄存器中
  - 优点：速度快
  - 缺点：寄存器数量有限
- 变址寻址
  - 基址寻址
  - 相对寻址
  - 变址寻址的应用场景
  - 有效地址的计算方法

### 4.3 指令集架构

- CISC 和 RISC 比较
  - CISC（复杂指令集）
    - 特点：指令数量多，指令长度可变
    - 优点：编程灵活，代码密度高
    - 缺点：实现复杂，功耗较高
  - RISC（精简指令集）
    - 特点：指令数量少，指令长度固定
    - 优点：实现简单，执行效率高
    - 缺点：程序长度可能较长
- 常见指令类型
  - 数据传送指令
  - 算术运算指令
  - 逻辑运算指令
  - 移位指令
  - 转移指令
  - 系统控制指令
- 指令流水线
  - 基本概念
    - 流水线的基本原理
    - 流水线的性能指标
  - 流水线的阶段
    - 取指（IF）
    - 译码（ID）
    - 执行（EX）
    - 访存（MEM）
    - 写回（WB）
  - 流水线冒险
    - 结构冒险
    - 数据冒险
    - 控制冒险
  - 流水线优化技术
    - 转发技术
    - 分支预测
    - 延迟槽

## 5. CPU 组成与设计

### 5.1 CPU 功能和结构

- 运算器（ALU）
  - 算术运算单元
  - 逻辑运算单元
  - 移位运算单元
  - 状态寄存器
- 控制器
  - 指令译码器
  - 时序控制器
  - 总线控制器
  - 中断控制器
- 寄存器组
  - 通用寄存器
  - 程序计数器（PC）
  - 指令寄存器（IR）
  - 状态寄存器（PSW）
  - 地址寄存器（AR）
  - 数据寄存器（DR）

### 5.2 指令周期

- 取指周期（IF）
  - PC 内容送至 MAR
  - 从主存读取指令到 IR
  - PC 自动加 1
- 执行周期（EX）
  - 指令译码
  - 操作数获取
  - 指令执行
  - 结果存储
- 中断周期
  - 中断请求检查
  - 现场保护
  - 中断服务
  - 现场恢复

### 5.3 数据通路

- 总线结构
  - 单总线结构
  - 多总线结构
  - 三总线结构
- 寄存器传送
  - 寄存器间数据传送
  - 寄存器与存储器间数据传送
  - 寄存器与 I/O 设备间数据传送
- 微操作序列
  - 取指微操作
  - 间址微操作
  - 执行微操作
  - 中断微操作

### 5.4 控制器设计

- 硬布线控制器
  - 组合逻辑设计
  - 时序逻辑设计
  - 状态转换图
  - 控制信号生成电路
- 微程序控制器
  - 微指令格式
  - 微程序存储器
  - 微程序计数器
  - 微指令译码器
  - 微程序设计方法
- 控制信号的产生
  - 时钟信号分配
  - 控制信号时序
  - 控制信号冲突处理
  - 关键路径分析

## 6. 总线

### 6.1 总线概述

- 总线的基本概念

  - 总线定义：连接各个部件的公共通信线路
  - 总线特征：分时性、共享性、标准化
  - 总线事务：读事务、写事务

- 总线分类

  - 片内总线：芯片内部的总线
  - 系统总线
    - 数据总线：双向传输数据
    - 地址总线：单向传输地址
    - 控制总线：传输控制信号
  - 通信总线：连接主机与外设

- 总线特性

  - 机械特性：接口形状、尺寸、管脚数
  - 电气特性：传输电平、信号强度
  - 功能特性：每根线的功能定义
  - 时间特性：信号时序关系

- 总线性能指标
  - 总线宽度：数据线的根数
  - 总线带宽：单位时间内传输数据量
  - 总线时钟频率：总线工作的时钟速率
  - 总线复用：地址线与数据线复用

### 6.2 总线仲裁

- 集中仲裁方式

  - 链式查询方式
    - 工作原理
    - 优缺点分析
  - 计数器定时查询方式
    - 实现方法
    - 应用场景
  - 独立请求方式
    - 电路结构
    - 优先级控制

- 分布仲裁方式

  - CSMA/CD 方式
  - Token Bus 方式
  - 自举式仲裁方式

- 链式仲裁方式
  - 硬件实现电路
  - 优先级确定方法
  - 仲裁过程分析

### 6.3 总线操作和定时

- 总线通信控制

  - 同步通信
    - 时钟同步方式
    - 严格同步控制
  - 异步通信
    - 应答方式
    - 握手信号协议

- 总线定时
  - 总线周期
  - 时序图分析
  - 建立时间和保持时间

### 6.4 总线标准

- 系统总线

  - ISA 总线
  - EISA 总线
  - VLB 总线

- PCI 总线

  - PCI 总线结构
  - PCI 信号定义
  - PCI 工作时序
  - PCI Express 技术
    - PCIe 的点对点结构
    - 传输速率演进
    - 链路层协议

- USB 总线
  - USB 协议版本演进
  - USB 拓扑结构
  - 传输类型
    - 控制传输
    - 批量传输
    - 中断传输
    - 等时传输
  - USB 供电特性

## 7. 输入输出系统

### 7.1 I/O 接口

- 接口的基本功能

  - 数据缓冲：解决设备与 CPU 速度不匹配问题
  - 数据格式转换：将设备数据格式转换为计算机内部格式
  - 控制和状态管理：管理设备的工作状态和控制信号
  - 地址译码：识别设备的 I/O 地址
  - 错误检测：检测数据传输过程中的错误

- 接口的类型

  - 按数据传送方式分类
    - 并行接口：同时传送多位数据（如打印机接口）
    - 串行接口：按位顺序传送数据（如 USB、串口）
  - 按功能分类
    - 通用接口：标准化接口，可连接多种设备
    - 专用接口：针对特定设备设计的接口

- 接口的通用结构
  - 设备选择电路
  - 数据缓冲寄存器
  - 状态寄存器
  - 控制寄存器
  - 总线接口电路

### 7.2 中断系统

- 中断的基本概念

  - 中断的定义：暂停当前程序执行，转而处理特定事件
  - 中断源类型
    - 外部中断：来自外设的中断请求
    - 内部中断：CPU 内部产生的中断
    - 软件中断：程序执行过程中的中断请求

- 中断处理过程

  - 中断请求的产生与检测
  - 中断响应的判优与排队
  - 现场保护（保存断点和寄存器内容）
  - 中断服务程序的执行
  - 现场恢复与中断返回

- 多重中断和中断屏蔽
  - 中断优先级系统
  - 中断嵌套处理机制
  - 中断向量表的组织
  - 中断屏蔽字的设置与使用

### 7.3 DMA 控制器

- DMA 传送方式

  - 停止 CPU 访问方式
  - 周期挪用方式
  - 透明 DMA 方式
  - 突发传送方式

- DMA 控制器结构

  - 数据缓冲寄存器
  - 地址计数器
  - 传送长度计数器
  - 控制/状态寄存器
  - 中断处理电路

- DMA 传送过程
  - DMA 请求与确认
  - 总线仲裁与控制
  - 数据传送过程
  - 传送完成处理
  - DMA 与中断的配合使用

### 7.4 I/O 设备管理

- 程序查询方式

  - 工作原理
  - 优缺点分析
  - 适用场景

- 中断驱动方式

  - 中断处理流程
  - 中断服务程序设计
  - 性能分析

- DMA 方式

  - DMA 通道编程
  - 数据块传送
  - 效率分析

- I/O 软件层次结构
  - 用户层 I/O 软件
  - 设备独立性软件
  - 设备驱动程序
  - 中断处理程序
